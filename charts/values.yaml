# GCP Validation Adapter - Helm Values
#
# Only environment-specific settings are exposed here.
# For advanced customization, modify the templates directly.

# Deployment mode: "fake" for fake-gcp-validation, "real" for gcp-validation
# Currently only "fake" is supported
deploymentMode: "fake"  # "fake" or "real"

replicaCount: 1

image:
  registry: quay.io/openshift-hyperfleet
  repository: hyperfleet-adapter
  pullPolicy: Always
  tag: "latest"

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  create: true
  # Annotations (optional, only needed for legacy GSA-based Workload Identity)
  # Modern approach uses direct principal binding - no annotation needed
  # Legacy: iam.gke.io/gcp-service-account: GSA_NAME@PROJECT_ID.iam.gserviceaccount.com
  annotations: {}
  name: ""

rbac:
  create: true
  # When enabled, grants minimal permissions needed for validation:
  # - Read namespaces
  # - Manage ServiceAccounts, Roles, RoleBindings, Jobs
  # - Read pods and update Job status

# Logging configuration
logging:
  # Verbosity level (0-10, higher = more verbose)
  verbosity: 2
  # Log to stderr instead of files
  logtostderr: true

# Platform-specific scheduling
nodeSelector: {}
tolerations: []
affinity: {}

# Broker configuration
# Set type to enable broker (required for adapter to function)
broker:
  type: "googlepubsub"  # "googlepubsub" or "rabbitmq"

  # Google Pub/Sub (required when type: googlepubsub)
  googlepubsub:
    projectId: ""
    topic: ""
    subscription: ""
    deadLetterTopic: ""  # Optional

  # RabbitMQ (required when type: rabbitmq)
  rabbitmq:
    url: ""  # amqp://user:pass@host:5672/

  subscriber:
    parallelism: 1

  # Raw YAML override (bypasses structured config above)
  yaml: ""

# HyperFleet API
hyperfleetApi:
  baseUrl: ""
  version: "v1"

# Validation-specific configuration (only for fake mode)
validation:
  # Status reporter image (sidecar container)
  statusReporterImage: "quay.io/rh-ee-dawang/status-reporter:dev-04e8d0a"

  # Fake validation simulation settings
  fake:
    # Simulated result: success, failure, hang, crash, invalid-json, missing-status
    simulateResult: "success"
    # Path where validation results are written
    resultsPath: "/results/adapter-result.json"
    # Maximum time to wait for validation completion (seconds)
    maxWaitTimeSeconds: "300"

# Additional environment variables
env: []
  # - name: MY_VAR
  #   value: "my-value"
  # - name: MY_SECRET
  #   valueFrom:
  #     secretKeyRef:
  #       name: my-secret
  #       key: key
