# GCP Validation Adapter - Helm Values
#
# Only environment-specific settings are exposed here.
# For advanced customization, modify the templates directly.

# Deployment mode: "dummy" for simulation, "real" for actual GCP validation
# - dummy: Uses Alpine shell script to simulate validation results
# - real: Uses Go-based validator to perform actual GCP API checks
deploymentMode: "real"  # "dummy" or "real"

replicaCount: 1

image:
  registry: registry.ci.openshift.org
  repository: ci/hyperfleet-adapter
  pullPolicy: Always
  tag: "latest"

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  create: true
  # Annotations (optional, only needed for legacy GSA-based Workload Identity)
  # Modern approach uses direct principal binding - no annotation needed
  # Legacy: iam.gke.io/gcp-service-account: GSA_NAME@PROJECT_ID.iam.gserviceaccount.com
  annotations: {}
  name: ""

rbac:
  create: true
  # When enabled, grants minimal permissions needed for validation:
  # - Read namespaces
  # - Manage ServiceAccounts, Roles, RoleBindings, Jobs
  # - Read pods and update Job status

# Logging configuration
logging:
  level: info   # Options: debug, info, warn, error
  format: text  # Options: text, json
  output: stderr  # Options: stdout, stderr

# Platform-specific scheduling
nodeSelector: {}
tolerations: []
affinity: {}

# Broker configuration
# Set type to enable broker (required for adapter to function)
broker:
  type: "googlepubsub"  # "googlepubsub" or "rabbitmq"

  # Google Pub/Sub (required when type: googlepubsub)
  googlepubsub:
    projectId: ""
    topic: ""
    subscription: ""
    deadLetterTopic: ""  # Optional

  # RabbitMQ (required when type: rabbitmq)
  rabbitmq:
    url: ""  # amqp://user:pass@host:5672/

  subscriber:
    parallelism: 1

  # Raw YAML override (bypasses structured config above)
  yaml: ""

# HyperFleet API
hyperfleetApi:
  baseUrl: ""
  version: "v1"

# Validation-specific configuration
validation:
  # Status reporter image (sidecar container)
  statusReporterImage: "registry.ci.openshift.org/ci/status-reporter:latest"

  # Dummy validation simulation settings (for deploymentMode: dummy)
  dummy:
    # Simulated result: success, failure, hang, crash, invalid-json, missing-status
    simulateResult: "success"
    # Path where validation results are written
    resultsPath: "/results/adapter-result.json"
    # Maximum time to wait for validation completion (seconds)
    maxWaitTimeSeconds: "300"

  # Real GCP validator settings (for deploymentMode: real)
  real:
    # GCP validator container image
    gcpValidatorImage: "registry.ci.openshift.org/ci/gcp-validator:latest"
    # Comma-separated list of validators to disable (default: all enabled)
    # Note: quota-check is a stub validator (not yet implemented, returns success)
    disabledValidators: "quota-check"
    # Comma-separated list of required GCP APIs to validate (default: empty)
    # Example: "compute.googleapis.com,storage-api.googleapis.com"
    requiredApis: "compute.googleapis.com,iam.googleapis.com,cloudresourcemanager.googleapis.com"
    # Path where validation results are written
    resultsPath: "/results/adapter-result.json"
    # Maximum time to wait for validation completion (seconds)
    maxWaitTimeSeconds: "300"

# Additional environment variables
env: []
  # - name: MY_VAR
  #   value: "my-value"
  # - name: MY_SECRET
  #   valueFrom:
  #     secretKeyRef:
  #       name: my-secret
  #       key: key
